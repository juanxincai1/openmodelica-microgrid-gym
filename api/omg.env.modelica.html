

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>omg.env.modelica &mdash; OpenModelica Microgrid 2020 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="omg.env.pyfmi" href="omg.env.pyfmi.html" />
    <link rel="prev" title="omg.env" href="omg.env.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> OpenModelica Microgrid
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../parts/user_guide/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parts/user_guide/OpenModelica.html">OpenModelica</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parts/user_guide/fmu.html">Functional Mock-up Unit (FMU)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parts/user_guide/Pythoncode.html">Toolbox Installation and General Remarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parts/user_guide/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parts/user_guide/controller_tuning.html">Controller Tuning Hints</a></li>
</ul>
<p class="caption"><span class="caption-text">API:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="omg.agents.html">omg.agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="omg.aux_ctl.html">omg.aux_ctl</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="omg.env.html">omg.env</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">omg.env.modelica</a></li>
<li class="toctree-l2"><a class="reference internal" href="omg.env.pyfmi.html">omg.env.pyfmi</a></li>
<li class="toctree-l2"><a class="reference internal" href="omg.env.plot.html">omg.env.plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="omg.env.plotmanager.html">omg.env.plotmanager</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="omg.execution.html">omg.execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="omg.net.html">omg.net</a></li>
<li class="toctree-l1"><a class="reference internal" href="omg.util.html">omg.util</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OpenModelica Microgrid</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="omg.env.html">omg.env</a> &raquo;</li>
        
      <li>omg.env.modelica</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/api/omg.env.modelica.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-openmodelica_microgrid_gym.env.modelica">
<span id="omg-env-modelica"></span><h1>omg.env.modelica<a class="headerlink" href="#module-openmodelica_microgrid_gym.env.modelica" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="openmodelica_microgrid_gym.env.modelica.ModelicaEnv">
<em class="property">class </em><code class="sig-prename descclassname">openmodelica_microgrid_gym.env.modelica.</code><code class="sig-name descname">ModelicaEnv</code><span class="sig-paren">(</span><em class="sig-param">net</em>, <em class="sig-param">time_start=0</em>, <em class="sig-param">reward_fun=&lt;function ModelicaEnv.&lt;lambda&gt;&gt;</em>, <em class="sig-param">abort_reward=-inf</em>, <em class="sig-param">is_normalized=True</em>, <em class="sig-param">log_level=30</em>, <em class="sig-param">solver_method='LSODA'</em>, <em class="sig-param">max_episode_steps=200</em>, <em class="sig-param">model_params=None</em>, <em class="sig-param">model_path='../omg_grid/grid.network.fmu'</em>, <em class="sig-param">viz_mode='episode'</em>, <em class="sig-param">viz_cols=None</em>, <em class="sig-param">history=&lt;openmodelica_microgrid_gym.util.recorder.FullHistory object&gt;</em>, <em class="sig-param">action_time_delay=0</em>, <em class="sig-param">on_episode_reset_callback=None</em>, <em class="sig-param">obs_output=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/openmodelica_microgrid_gym/env/modelica.html#ModelicaEnv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#openmodelica_microgrid_gym.env.modelica.ModelicaEnv" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">gym.core.Env</span></code></p>
<p>OpenAI gym Environment encapsulating an FMU model.</p>
<p>Initialize the Environment.
The environment can only be used after reset() is called.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>time_start</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – offset of the time in seconds</p></li>
<li><p><strong>reward_fun</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]) – The function receives as a list of variable names and a np.ndarray of the values
of the current observation as well as a risk value between 0 and 1.
The separation is mainly for performance reasons, such that the resolution of data indices can be cached.
It must return the reward of this timestep as float.
It should return np.nan or -np.inf or None in case of a failiure.
It should have no side-effects</p></li>
<li><p><strong>abort_reward</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]) – reward returned on episode abort</p></li>
<li><p><strong>log_level</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – logging granularity. see logging in stdlib</p></li>
<li><p><strong>solver_method</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – solver of the scipy.integrate.solve_ivp function</p></li>
<li><p><strong>max_episode_steps</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – <p>maximum number of episode steps.
After one episodes there are max_episode_steps+1 states available (one additionally caused by the reset)
and max_episode_steps actions, so the env.step() is executed max_episode_steps-times
The end time of the episode is calculated by the time resolution and the number of steps.</p>
<p>If set to None, the environment will never finish because of step sizes, but it might still stop because of
system failure (-inf reward)</p>
</p></li>
<li><p><strong>model_params</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>], <code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]], <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]]]) – <p>parameters of the FMU.
dictionary of variable names and scalars or callables.
If a callable is provided it is called on reset with t==-1 and in every time step with the current time.
This callable must return a float or None
The float is passed to the fmu, None values are discarded.
This allows setting initial values using like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lc1.capacitor1.v&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span> <span class="k">if</span> <span class="n">t</span><span class="o">==-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span><span class="p">}</span>
</pre></div>
</div>
<p>as well as continuosly changing values using like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lc1.capacitor1.v&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()}</span>
</pre></div>
</div>
</p></li>
<li><p><strong>net</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <a class="reference internal" href="omg.net.base.html#openmodelica_microgrid_gym.net.base.Network" title="openmodelica_microgrid_gym.net.base.Network"><code class="xref py py-class docutils literal notranslate"><span class="pre">Network</span></code></a>]) – Path to the network configuration file passed to the net.Network.load() function</p></li>
<li><p><strong>model_path</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Path to the FMU</p></li>
<li><p><strong>viz_mode</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]) – <p>specifies how and if to render</p>
<ul>
<li><p>’episode’: render after the episode is finished</p></li>
<li><p>’step’: render after each time step</p></li>
<li><p>None: disable visualization</p></li>
</ul>
</p></li>
<li><p><strong>viz_cols</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <a class="reference internal" href="omg.env.plot.html#openmodelica_microgrid_gym.env.plot.PlotTmpl" title="openmodelica_microgrid_gym.env.plot.PlotTmpl"><code class="xref py py-class docutils literal notranslate"><span class="pre">PlotTmpl</span></code></a>]], <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]) – <p>enables specific columns while plotting</p>
<ul>
<li><p>None: all columns will be used for visualization (default)</p></li>
<li><p>string: will be interpret as regex. all fully matched columns names will be enabled</p></li>
<li><dl class="simple">
<dt>list of strings: Each string might be a unix-shell style wildcard like “<a href="#id1"><span class="problematic" id="id2">*</span></a>.i”</dt><dd><p>to match all data series ending with “.i”.</p>
</dd>
</dl>
</li>
<li><p>list of PlotTmpl: Each template will result in a plot</p></li>
</ul>
</p></li>
<li><p><strong>history</strong> (<a class="reference internal" href="omg.util.recorder.html#openmodelica_microgrid_gym.util.recorder.EmptyHistory" title="openmodelica_microgrid_gym.util.recorder.EmptyHistory"><code class="xref py py-class docutils literal notranslate"><span class="pre">EmptyHistory</span></code></a>) – history to store observations and measurement (from the agent) after each step</p></li>
<li><p><strong>action_time_delay</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Defines how many time steps the controller needs before the action is applied; action
is buffered in an array</p></li>
<li><p><strong>on_episode_reset_callback</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[], <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]]) – Callable which is executed during the environment reset. Can be used for
example to reset external processes like random process used in model params and to synchronize their reset
to the env reset</p></li>
<li><p><strong>obs_output</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]]) – List of strings of observations given to the agent. obs_output is compared to history.cols (
variable names have to fit)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="openmodelica_microgrid_gym.env.modelica.ModelicaEnv.close">
<code class="sig-name descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/openmodelica_microgrid_gym/env/modelica.html#ModelicaEnv.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#openmodelica_microgrid_gym.env.modelica.ModelicaEnv.close" title="Permalink to this definition">¶</a></dt>
<dd><p>OpenAI Gym API. Closes environment and all related resources.
Closes rendering.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True on success</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="openmodelica_microgrid_gym.env.modelica.ModelicaEnv.is_done">
<em class="property">property </em><code class="sig-name descname">is_done</code><a class="headerlink" href="#openmodelica_microgrid_gym.env.modelica.ModelicaEnv.is_done" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if the experiment is finished using a time limit</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if simulation time exceeded</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="openmodelica_microgrid_gym.env.modelica.ModelicaEnv.render">
<code class="sig-name descname">render</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mode</span><span class="o">=</span><span class="default_value">'human'</span></em>, <em class="sig-param"><span class="n">close</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/openmodelica_microgrid_gym/env/modelica.html#ModelicaEnv.render"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#openmodelica_microgrid_gym.env.modelica.ModelicaEnv.render" title="Permalink to this definition">¶</a></dt>
<dd><p>OpenAI Gym API. Determines how current environment state should be rendered.
Does nothing at the moment</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mode</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – (ignored) rendering mode. Read more in Gym docs.</p></li>
<li><p><strong>close</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – flag if rendering procedure should be finished and resources cleaned. Used, when environment is closed.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Figure</span></code>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="openmodelica_microgrid_gym.env.modelica.ModelicaEnv.reset">
<code class="sig-name descname">reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/openmodelica_microgrid_gym/env/modelica.html#ModelicaEnv.reset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#openmodelica_microgrid_gym.env.modelica.ModelicaEnv.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>OpenAI Gym API. Restarts environment and sets it ready for experiments.
In particular, does the following:</p>
<blockquote>
<div><ul class="simple">
<li><p>resets model</p></li>
<li><p>sets simulation start time to 0</p></li>
<li><dl class="simple">
<dt>sets initial parameters of the model</dt><dd><ul>
<li><p>Using the parameters defined in self.model_parameters</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>initializes the model</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>state of the environment after resetting. If self.ob_output is not None, the there defined outputs are
returned.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="openmodelica_microgrid_gym.env.modelica.ModelicaEnv.step">
<code class="sig-name descname">step</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">action</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/openmodelica_microgrid_gym/env/modelica.html#ModelicaEnv.step"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#openmodelica_microgrid_gym.env.modelica.ModelicaEnv.step" title="Permalink to this definition">¶</a></dt>
<dd><p>OpenAI Gym API. Determines how one simulation step is performed for the environment.
Simulation step is execution of the given action in a current state of the environment.</p>
<p>The state also contains the measurement.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>action</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code>) – action to be executed.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Mapping</span></code>]</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>state, reward, is done, info</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="openmodelica_microgrid_gym.env.modelica.ModelicaEnv.viz_modes">
<code class="sig-name descname">viz_modes</code><em class="property"> = {'step', None, 'episode'}</em><a class="headerlink" href="#openmodelica_microgrid_gym.env.modelica.ModelicaEnv.viz_modes" title="Permalink to this definition">¶</a></dt>
<dd><p>Set of all valid visualisation modes</p>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="omg.env.pyfmi.html" class="btn btn-neutral float-right" title="omg.env.pyfmi" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="omg.env.html" class="btn btn-neutral float-left" title="omg.env" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Bode, Heid, Wallscheid, Weber.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>